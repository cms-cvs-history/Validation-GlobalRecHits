process GLOBAL = {

   untracked PSet maxEvents = {untracked int32 input = 1}

   ## setup useful services
   ##
   include "Validation/GlobalRecHits/data/Random.cfi"
   include "Validation/GlobalRecHits/data/MessageLogger.cfi"

   //service = Timing { }  
   //service = SimpleMemoryCheck { untracked int32 ignoreTotal = 1 }      

   ## Step 1 : Read In MC events
   ##
   ## read in a reference MC file
   source = PoolSource
   {
      untracked vstring fileNames = 
      {
         'file:/afs/cern.ch/cms/data/CMSSW/Validation/GlobalHits/data/MC_100p2_minbias.root'
         //'file:MC_100p2_minbias.root'
      }
      //untracked int32 maxEvents = 10000
   }

   ## Step 2 : CMS Detector Simulation
   ##
   ## CMS Det.Simulation module (OscarProducer)
   ##
   ## Geometry
   ##
   ## can't use official yet as it is configuration.xml rather than 
   ## SimConfiguration (how to change?)
   //include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"
   //include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"
   //es_module = TrackerGeometricDetESModule {}
		
   ## Magnetic Field
   ##
   include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
		
   ## module g4SimHits
   include "SimG4Core/Application/data/g4SimHits.cfi"

   ## Step 3: CMS Detector Digitization
   ## need mixing module
   include "Configuration/StandardSequences/data/MixingNoPileUp.cff"
   ##include "Configuration/StandardSequences/data/MixingHighLumiPileUp.cff"
   ##include "Configuration/StandardSequences/data/MixingLowLumiPileUp.cff"

   ## need digitization
   include "Configuration/StandardSequences/data/Digi.cff"
   include "CalibCalorimetry/EcalTrivialCondModules/data/EcalTrivialCondRetriever.cfi"

   ## Step 4: CMS Detector Reconstruction
   include "Configuration/StandardSequences/data/Reconstruction.cff"

   ## Step 5 : Accumulation of globally transformed data
   ##
   ## module globalrechits
   include "Validation/GlobalRecHits/data/globalrechits.cfi"
   replace globalrechits.Verbosity = 0
   replace globalrechits.Frequency = 50

   ## Step 6 : Output module
   ##
   module o1 = PoolOutputModule 
   { 
      untracked string fileName = "GlobalRecHits.root"
      untracked vstring outputCommands = 
      {
        "keep *_globalrechits_*_*"
      }
   }

   ## Step 6: execute path
   ## Global producer needs DetSim, 
   ## can use smeared vertex, can't use mixing
   ##
   path p1 = { g4SimHits, mix, doAllDigi, reconstruction, globalrechits }
   endpath outpath = { o1 }
	
}
